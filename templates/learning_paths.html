{% extends "base.html" %}

{% block title %}Learning Paths - BharatGen Acharya{% endblock %}

{% block extra_css %}
<style>
    /* --- PAGE LAYOUT STYLES --- */
    .page-header {
        text-align: center;
        margin-bottom: 3rem;
        padding-top: 2rem;
    }

    .page-header h1 {
        font-family: 'Merriweather', serif;
        font-size: 2.5rem;
        color: var(--brand-primary);
        margin-bottom: 0.5rem;
    }

    .page-header p {
        color: var(--text-secondary);
        font-size: 1.1rem;
    }

    /* --- FILTERS (Glassmorphism) --- */
    .filters {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 3rem;
        flex-wrap: wrap;
    }

    .filters select, 
    .filters input {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.6);
        padding: 0.75rem 1.5rem;
        border-radius: 99px;
        font-family: 'Inter', sans-serif;
        font-size: 0.95rem;
        color: var(--text-primary);
        outline: none;
        transition: all 0.2s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .filters select:focus, 
    .filters input:focus {
        background: #fff;
        border-color: var(--brand-primary);
        box-shadow: 0 4px 15px rgba(0, 0, 128, 0.15);
    }

    .filters input {
        width: 300px;
    }

    /* --- GRID --- */
    .path-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 2rem;
        min-height: 400px; /* Prevent layout jump while loading */
    }

    /* --- CARD DESIGN --- */
    .path-card {
        background: #fff;
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: var(--shadow-float);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .path-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 25px 50px rgba(0,0,0,0.12);
    }

    /* Image Placeholder */
    .path-card img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        background: #f0f0f0;
    }

    /* Content Area */
    .path-card-content {
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        flex: 1;
    }

    .difficulty-badge {
        align-self: flex-start;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        padding: 0.25rem 0.75rem;
        border-radius: 99px;
        margin-bottom: 0.75rem;
        letter-spacing: 0.5px;
    }

    .difficulty-badge.beginner { background: rgba(19, 136, 8, 0.1); color: var(--accent-green); }
    .difficulty-badge.intermediate { background: rgba(255, 153, 51, 0.1); color: var(--accent-orange); }
    .difficulty-badge.advanced { background: rgba(0, 0, 128, 0.1); color: var(--brand-primary); }
    .difficulty-badge.expert { background: rgba(0, 0, 0, 0.1); color: #333; }

    .path-card h3 {
        font-family: 'Merriweather', serif;
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }

    .path-card p {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-bottom: 1.25rem;
        line-height: 1.5;
        flex-grow: 1; /* Pushes meta/footer down */
    }

    /* Meta Info (Icons) */
    .path-meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
        border-bottom: 1px solid #eee;
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.35rem;
    }

    .meta-item svg {
        stroke: var(--brand-primary);
        width: 16px;
        height: 16px;
    }

    /* Tags */
    .path-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1.25rem;
    }

    .tag {
        background: #F4F6F8;
        color: var(--text-secondary);
        padding: 0.25rem 0.75rem;
        border-radius: 6px;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .tag svg {
        width: 12px;
        height: 12px;
        stroke: #777;
    }

    /* Buttons inside cards */
    .btn {
        display: inline-block;
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.9rem;
        text-align: center;
        transition: all 0.2s ease;
    }

    .btn-primary {
        background: var(--brand-primary);
        color: white;
        border: 1px solid var(--brand-primary);
        width: 100%;
    }

    .btn-primary:hover {
        background: #000060;
        box-shadow: 0 4px 12px rgba(0, 0, 128, 0.2);
    }

    .btn-outline {
        background: transparent;
        color: var(--text-primary);
        border: 1px solid #ddd;
        width: 100%;
    }

    .btn-outline:hover {
        border-color: var(--brand-primary);
        color: var(--brand-primary);
        background: rgba(0,0,128,0.02);
    }

    /* Loading/Empty States */
    .loading, .error, .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: 4rem;
        color: var(--text-secondary);
        font-size: 1.1rem;
    }

    @media (max-width: 768px) {
        .filters input {
            width: 100%;
        }
        .filters {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>AI Learning Paths</h1>
        <p>Master your future with curated journeys in Generative AI</p>
    </div>

    <!-- Filters -->
    <div class="filters">
        <select id="difficultyFilter" onchange="filterPaths()">
            <option value="">All Levels</option>
            <option value="beginner">Beginner</option>
            <option value="intermediate">Intermediate</option>
            <option value="advanced">Advanced</option>
            <option value="expert">Expert</option>
        </select>
        
        <input type="text" id="searchInput" placeholder="Search learning paths..." onkeyup="filterPaths()">
    </div>

    <!-- Learning Paths Grid -->
    <div id="learningPaths" class="path-grid">
        <div class="loading">Loading learning paths...</div>
    </div>
</div>

<script>
// Define SVG Icons as constants for reuse
const icons = {
    clock: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>`,
    book: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>`,
    star: `<svg viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`,
    tag: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>`
};

let allPaths = [];

// Mock Data to use if API returns empty or fails
const MOCK_DATA = [
    {
        title: "Introduction to LLMs",
        description: "Learn the basics of Large Language Models and how they work.",
        difficulty_level: "beginner",
        estimated_hours: 5,
        module_count: 4,
        average_rating: 4.8,
        tags: ["AI", "NLP", "Theory"],
        is_enrolled: true,
        slug: "intro-to-llms"
    },
    {
        title: "Building RAG Applications",
        description: "Create Retrieval-Augmented Generation apps with vector databases.",
        difficulty_level: "intermediate",
        estimated_hours: 12,
        module_count: 8,
        average_rating: 4.5,
        tags: ["Python", "Vector DB", "Llama 3"],
        is_enrolled: false,
        slug: "building-rag"
    },
    {
        title: "Advanced Prompt Engineering",
        description: "Master the art of prompting for specific outputs.",
        difficulty_level: "advanced",
        estimated_hours: 8,
        module_count: 5,
        average_rating: 4.9,
        tags: ["Prompting", "GPT", "Deep Learning"],
        is_enrolled: false,
        slug: "advanced-prompting"
    }
];

async function loadLearningPaths() {
    try {
        // NOTE: This assumes apiCall is defined in /static/js/main.js
        const paths = await apiCall('/api/learning/paths/');
        allPaths = paths.results || paths;
        
        // FIX: If API returns empty list, fallback to MOCK DATA
        if (allPaths.length === 0) {
            console.warn("API returned empty paths. Using Mock Data for demo.");
            allPaths = MOCK_DATA;
        }
        
        renderPaths(allPaths);
    } catch (error) {
        console.error('Error loading learning paths:', error);
        
        // FIX: On Error, fallback to MOCK DATA so user can see UI
        console.warn("API Error. Using Mock Data for demo.");
        allPaths = MOCK_DATA;
        renderPaths(allPaths);
    }
}

function renderPaths(paths) {
    const container = document.getElementById('learningPaths');
    
    if (paths.length === 0) {
        // This usually shouldn't trigger if we use Mock Data fallback, 
        // but we keep it for "Search matches no results" scenario.
        container.innerHTML = '<p class="empty-state">No learning paths found matching your criteria.</p>';
        return;
    }
    
    container.innerHTML = paths.map(path => `
        <div class="path-card">
            ${path.thumbnail ? `<img src="${path.thumbnail}" alt="${path.title}">` : ''}
            <div class="path-card-content">
                <div class="difficulty-badge ${path.difficulty_level || 'beginner'}">${path.difficulty_level || 'Beginner'}</div>
                <h3>${path.title}</h3>
                <p>${path.description ? path.description.substring(0, 150) + '...' : 'No description available.'}</p>
                
                <div class="path-meta">
                    <div class="meta-item" title="Duration">
                        ${icons.clock} <span>${path.estimated_hours || 0}h</span>
                    </div>
                    <div class="meta-item" title="Modules">
                        ${icons.book} <span>${path.module_count || 0}</span>
                    </div>
                    <div class="meta-item" title="Rating">
                        ${icons.star} <span>${path.average_rating ? path.average_rating.toFixed(1) : 'N/A'}</span>
                    </div>
                </div>
                
                <div class="path-tags">
                    ${(path.tags || []).slice(0, 3).map(tag => `<span class="tag">${icons.tag} ${tag}</span>`).join('')}
                </div>
                
                ${path.is_enrolled 
                    ? '<a href="/learning-paths/' + path.slug + '/" class="btn btn-primary">Continue Learning</a>'
                    : '<a href="/learning-paths/' + path.slug + '/" class="btn btn-outline">View Details</a>'
                }
            </div>
        </div>
    `).join('');
}

function filterPaths() {
    const difficulty = document.getElementById('difficultyFilter').value;
    const search = document.getElementById('searchInput').value.toLowerCase();
    
    let filtered = allPaths;
    
    if (difficulty) {
        filtered = filtered.filter(path => path.difficulty_level === difficulty);
    }
    
    if (search) {
        filtered = filtered.filter(path => 
            path.title.toLowerCase().includes(search) || 
            (path.description && path.description.toLowerCase().includes(search))
        );
    }
    
    renderPaths(filtered);
}

// Initialize
document.addEventListener('DOMContentLoaded', loadLearningPaths);
</script>
{% endblock %}